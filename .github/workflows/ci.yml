name: wayland
on:
  pull_request:
  push:
    branches:
      - main
  workflow_call:
  workflow_dispatch:

# Cancel active CI runs for a PR before starting another run
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

defaults:
  run:
    shell: bash --noprofile --norc -x -e -o pipefail {0}

env:
  FORCE_COLOR: "1"

jobs:
  wayland:
    name: wayland
    runs-on: ubuntu-24.04
    steps:

    - name: Checkout
      uses: actions/checkout@v4.1.6
      with:
        fetch-depth: 0

    - name: Install
      run: |
        sudo apt update
        sudo apt install -y weston sway libwayland-dev wayland-utils

    - name: Wayland
      env:
        WLR_BACKENDS: headless
      run: |
        #sudo weston --backends
        sudo weston --no-config --socket=wayland-1 --width 2048 --height 1536 --backend headless
        #sway -d -V &
    
    - name: Run app
      env:
        WAYLAND_DISPLAY: wayland-1
      run: wayland-info

